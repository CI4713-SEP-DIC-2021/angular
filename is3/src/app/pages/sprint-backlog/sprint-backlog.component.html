<div class="fondo">
    <app-sidebar></app-sidebar>

  <!-- Sprint Backlog Card -->
  <mat-card style="width: 70%; margin: 0 auto; margin-top: 30px; height: 35rem; overflow: scroll;">
      <mat-card-title>Sprint Backlog</mat-card-title>
      <mat-divider style="margin-top: 10px"></mat-divider>
    
      <mat-card-subtitle style="font-weight: bold; margin-top: 40px;">Historias de Usuario</mat-card-subtitle>  

      <div class="example-table-container">
        <!-- Table of user stories -->
        <table mat-table *ngIf="storiesList" [dataSource]="storiesList" class="mat-elevation-z8" style="width: 100%">
        
          <!-- ID Column -->
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef> Id. </th>
            <td mat-cell *matCellDef="let element" [ngStyle]="{'background-color': element.parent_id == null ? '#F0F0F0':''}"> {{element.id}} </td>
          </ng-container>

          <!-- Description Column -->
          <ng-container matColumnDef="description">
            <th mat-header-cell *matHeaderCellDef> Historias de Usuario </th>
            <td mat-cell *matCellDef="let element" [ngStyle]="{'background-color': element.parent_id == null ? '#F0F0F0':''}"> {{ element.description }} </td>
          </ng-container>

          <!-- Épica -->
          <ng-container matColumnDef="epica">
            <th mat-header-cell *matHeaderCellDef> Épica </th>
            <td mat-cell *matCellDef="let element" [ngStyle]="{'background-color': element.parent_id == null ? '#F0F0F0':''}">
              <mat-checkbox [disabled]="true" [checked]="element.epic"></mat-checkbox>
            </td>
          </ng-container>

          <!-- Priority column -->
          <ng-container matColumnDef="priority">
            <th mat-header-cell *matHeaderCellDef> Prioridad </th>
            <td mat-cell *matCellDef="let element" [ngStyle]="{'background-color': element.parent_id == null ? '#F0F0F0':''}">

              <mat-form-field appearance="outline" style="width: 100px; height: 60px">
                <mat-select [value]="element.priority" [disabled]="true">
                  <mat-option value="high">Alta</mat-option>
                  <mat-option value="medium">Media</mat-option>
                  <mat-option value="low">Baja</mat-option>
                </mat-select>
              </mat-form-field>
            </td>
          </ng-container>

          <!-- Add Column -->
          <ng-container matColumnDef="add">
            <th mat-header-cell *matHeaderCellDef>  </th>
            <td mat-cell *matCellDef="let element" [ngStyle]="{'background-color': element.parent_id == null ? '#F0F0F0':''}">
                <!-- Add criteria -->
                <button mat-icon-button [disabled]="current_user_role != 'Scrum Team'" (click)="addCriteriaDialog(element.id)">
                    <mat-icon>add_circle_outline</mat-icon>
                    Criterio
                </button>

                <!-- Add acceptance test -->
                <button mat-icon-button [disabled]="current_user_role != 'Product Owner'" (click)="addTestDialog(element.id)" style="margin-left: 50px">
                  <mat-icon>add_circle_outline</mat-icon>
                  Prueba
                </button>


                <!-- Add task -->
                <button mat-icon-button (click)="addTaskDialog(element.id)" style="margin-left: 50px">
                  <mat-icon>add_circle_outline</mat-icon>
                  Tarea
                </button>

            </td>
          </ng-container>
        
        
          <tr mat-header-row *matHeaderRowDef="displayedColumnsStories"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumnsStories;"></tr>
        </table>
      </div>


      <!-- Table: Criterios de Aceptación -->
      <mat-card-subtitle style="font-weight: bold; margin-top: 40px;">Criterios de aceptación</mat-card-subtitle>  

      <div class="example-table-container">
        <!-- Table of criteria -->
        <table mat-table *ngIf="criteriaList" [dataSource]="criteriaList" class="mat-elevation-z8" style="width: 100%">
        
          <!-- ID Column -->
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef> Id. </th>
            <td mat-cell *matCellDef="let element"> {{element.story.id + "." + element.id}} </td>
          </ng-container>

          <!-- Description Column -->
          <ng-container matColumnDef="description">
            <th mat-header-cell *matHeaderCellDef> Criterios de aceptación </th>
            <td mat-cell *matCellDef="let element"> {{ element.description }} </td>
          </ng-container>

          <!-- Approved Column -->
          <ng-container matColumnDef="approved">
            <th mat-header-cell *matHeaderCellDef> Estado </th>
            <td mat-cell *matCellDef="let element">
              <mat-checkbox [checked]="element.approved" (change)="changeApprovedStatus(element)"></mat-checkbox>
            </td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>  </th>
            <td mat-cell *matCellDef="let element">
                <!-- Edit criteria -->
                <button mat-icon-button [disabled]="current_user_role != 'Scrum Team'" (click)="editCriteriaDialog(element)" style="margin-right: 30px">
                    <mat-icon>edit</mat-icon>
                </button>

                <!-- Delete criteria -->
                <button mat-icon-button [disabled]="current_user_role != 'Scrum Team'" (click)="deleteCriteriaDialog(element.id)">
                  <mat-icon>delete</mat-icon>
              </button>
            </td>
          </ng-container>
        
        
          <tr mat-header-row *matHeaderRowDef="displayedColumnsCriteria"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumnsCriteria;"></tr>
        </table>
      </div>


      <!-- Table: Pruebas de Aceptación -->
      <mat-card-subtitle style="font-weight: bold; margin-top: 40px;">Pruebas de aceptación</mat-card-subtitle>  

      <div class="example-table-container">
        <!-- Table of acceptance tests -->
        <table mat-table *ngIf="testsList" [dataSource]="testsList" class="mat-elevation-z8" style="width: 100%">
        
          <!-- ID Column -->
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef> Id. </th>
            <td mat-cell *matCellDef="let element"> {{element.story.id + "." + element.id}} </td>
          </ng-container>

          <!-- Description Column -->
          <ng-container matColumnDef="description">
            <th mat-header-cell *matHeaderCellDef> Pruebas de aceptación </th>
            <td mat-cell *matCellDef="let element"> {{ element.description }} </td>
          </ng-container>

          <!-- Approved Column -->
          <ng-container matColumnDef="approved">
            <th mat-header-cell *matHeaderCellDef> Estado </th>
            <td mat-cell *matCellDef="let element">
              <mat-checkbox [checked]="element.approved" (change)="changeStatusTests(element)"></mat-checkbox>
            </td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>  </th>
            <td mat-cell *matCellDef="let element">
                <!-- Edit acceptance tests -->
                <button mat-icon-button [disabled]="current_user_role != 'Product Owner'" (click)="editTestDialog(element)" style="margin-right: 30px">
                    <mat-icon>edit</mat-icon>
                </button>

                <!-- Delete aceptance tests -->
                <button mat-icon-button [disabled]="current_user_role != 'Product Owner'" (click)="deleteTestDialog(element.id)">
                  <mat-icon>delete</mat-icon>
              </button>
            </td>
          </ng-container>
        
          <tr mat-header-row *matHeaderRowDef="displayedColumnsTests"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumnsTests;"></tr>
        </table>
      </div>



      <!-- Table: Tareas -->
      <mat-card-subtitle style="font-weight: bold; margin-top: 40px;">Tareas, Estimación y Asignación</mat-card-subtitle>  

      <div class="example-table-container">
        <!-- Table of tasks -->
        <table mat-table *ngIf="tasksList" [dataSource]="tasksList" class="mat-elevation-z8" style="width: 100%">
        
          <!-- ID Column -->
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef> Id. </th>
            <td mat-cell *matCellDef="let element"> {{element.story_id + '.' + element.id}} </td>
          </ng-container>

          <!-- Description Column -->
          <ng-container matColumnDef="description">
            <th mat-header-cell *matHeaderCellDef> Tarea </th>
            <td mat-cell *matCellDef="let element"> {{ element.description }} </td>
          </ng-container>

          <!-- Type Column -->
          <ng-container matColumnDef="type">
            <th mat-header-cell *matHeaderCellDef> Tipo </th>
            <td mat-cell *matCellDef="let element"> {{ element.task_type }} </td>
          </ng-container>

          <!-- Status Column -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef> Estado </th>
            <td mat-cell *matCellDef="let element"> {{ element.task_status }} </td>
          </ng-container>

          <!-- Users Column -->
          <ng-container matColumnDef="users">
            <th mat-header-cell *matHeaderCellDef> Asignada </th>
            <td mat-cell *matCellDef="let element"> {{ getUserString(element.users) }} </td>
          </ng-container>

          <!-- Class Column -->
          <ng-container matColumnDef="class">
            <th mat-header-cell *matHeaderCellDef> Clase </th>
            <td mat-cell *matCellDef="let element"> {{ element.task_class }} </td>
          </ng-container>

          <!-- Functions Column -->
          <ng-container matColumnDef="functions">
            <th mat-header-cell *matHeaderCellDef> Funciones </th>
            <td mat-cell *matCellDef="let element"> {{ element.functions }} </td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>  </th>
            <td mat-cell *matCellDef="let element">
                <!-- Edit task -->
                <button mat-icon-button (click)="editTaskDialog(element)" style="margin-right: 30px">
                    <mat-icon>edit</mat-icon>
                </button>

                <!-- Delete task -->
                <button mat-icon-button (click)="deleteTaskDialog(element.id)">
                  <mat-icon>delete</mat-icon>
              </button>
            </td>
          </ng-container>
        
        
          <tr mat-header-row *matHeaderRowDef="displayedColumnsTasks"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumnsTasks;"></tr>
        </table>
      </div>


      <!-- Sprint information -->
      
      <div style="margin-top: 40px">
        <mat-label style="margin-right: 10px; font-weight: bold">Inicio:</mat-label>
        <mat-label class="sprint-label">{{ sprint_init_date }}</mat-label>
        <mat-label style="margin-left: 30px; margin-right: 10px; font-weight: bold">Cierre:</mat-label>
        <mat-label class="sprint-label">{{ sprint_end_date }}</mat-label>
        <mat-label style="margin-left: 30px; margin-right: 10px; font-weight: bold">Duración:</mat-label>
        <mat-label class="sprint-label">{{ sprint_duration + ' días' }}</mat-label>
        <mat-label style="margin-left: 30px; margin-right: 10px; font-weight: bold">Tiempo estimado:</mat-label>
        <mat-label class="sprint-label">{{ sprint_est_time + ' h'}}</mat-label>
      </div>

    </mat-card>
    
  <app-footer></app-footer>
</div>
